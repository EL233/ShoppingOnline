<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†åå° - ELæ‚è´§é“º</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header id="navbar">
        <div id="language-switcher">
            <select id="lang-select">
                <option value="zh" selected>ä¸­æ–‡</option>
                <option value="en">English</option>
            </select>
        </div>
        <nav id="nav-links">
            <a href="index.html">è¿”å›é¦–é¡µ</a>
            <a href="#" onclick="logoutAdmin()">é€€å‡ºç®¡ç†</a>
        </nav>
        <div id="homeIcon">
            <a href="index.html">
                <img src="images/123.JPG" alt="logo"/>
            </a>
        </div>
    </header>

    <div class="admin-container">
        <!-- ä¾§è¾¹æ  -->
        <div class="admin-sidebar">
            <div class="sidebar-header">
                <h3>ç®¡ç†åå°</h3>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" onclick="showSection('dashboard')">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span class="nav-text">ä»ªè¡¨ç›˜</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('products')">
                    <span class="nav-icon">ğŸ“¦</span>
                    <span class="nav-text">å•†å“ç®¡ç†</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('users')">
                    <span class="nav-icon">ğŸ‘¥</span>
                    <span class="nav-text">ç”¨æˆ·ç®¡ç†</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('orders')">
                    <span class="nav-icon">ğŸ“‹</span>
                    <span class="nav-text">è®¢å•ç®¡ç†</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('finance')">
                    <span class="nav-icon">ğŸ’°</span>
                    <span class="nav-text">è´¢åŠ¡ç®¡ç†</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('inventory')">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span class="nav-text">åº“å­˜ç®¡ç†</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('featured')">
                    <span class="nav-icon">â­</span>
                    <span class="nav-text">ç²¾é€‰å•†å“</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('invoice')">
                    <span class="nav-icon">ğŸ§¾</span>
                    <span class="nav-text">å‘ç¥¨ç®¡ç†</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('coupon')">
                    <span class="nav-icon">ğŸ«</span>
                    <span class="nav-text">ä¼˜æƒ åˆ¸ç®¡ç†</span>
                </a>
            </nav>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="admin-main">
            <!-- ä»ªè¡¨ç›˜ -->
            <div id="dashboard" class="admin-section active">
                <div class="section-header">
                    <h2>ä»ªè¡¨ç›˜</h2>
                    <span id="current-time"></span>
                </div>

                <!-- ç»Ÿè®¡å¡ç‰‡ -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ‘¥</div>
                        <div class="stat-content">
                            <h3 id="total-users">156</h3>
                            <p>æ€»ç”¨æˆ·æ•°</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“¦</div>
                        <div class="stat-content">
                            <h3 id="total-products">10</h3>
                            <p>å•†å“æ€»æ•°</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ’°</div>
                        <div class="stat-content">
                            <h3 id="total-revenue">Â¥12,345</h3>
                            <p>æ€»æ”¶å…¥</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“‹</div>
                        <div class="stat-content">
                            <h3 id="total-orders">89</h3>
                            <p>è®¢å•æ€»æ•°</p>
                        </div>
                    </div>
                </div>

                <!-- å›¾è¡¨åŒºåŸŸ -->
                <div class="charts-container">
                    <div class="chart-card">
                        <h3>é”€å”®è¶‹åŠ¿</h3>
                        <canvas id="salesChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>å•†å“åˆ†ç±»ç»Ÿè®¡</h3>
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- å•†å“ç®¡ç† -->
            <div id="products" class="admin-section">
                <div class="section-header">
                    <h2>å•†å“ç®¡ç†</h2>
                    <button class="btn btn-primary" onclick="showAddProductForm()">æ·»åŠ å•†å“</button>
                </div>

                <!-- ç­›é€‰å’Œæœç´¢ -->
                <div class="filters">
                    <input type="text" id="product-search" placeholder="æœç´¢å•†å“..." onkeyup="handleProductSearch(event)">
                    <select id="category-filter" onchange="handleProductSearch()">
                        <option value="">æ‰€æœ‰åˆ†ç±»</option>
                        <option value="anime">åŠ¨æ¼«</option>
                        <option value="game">æ¸¸æˆ</option>
                        <option value="other">å…¶ä»–</option>
                    </select>
                    <button class="btn btn-primary" onclick="searchProducts()">æœç´¢</button>
                    <button class="btn btn-secondary" onclick="resetProductSearch()">é‡ç½®</button>
                </div>

                <!-- å•†å“åˆ—è¡¨ -->
                <div class="table-container">
                    <table id="products-table">
                        <thead>
                            <tr>
                                <th>å•†å“åç§°</th>
                                <th>ä»·æ ¼</th>
                                <th>åº“å­˜</th>
                                <th>åˆ†ç±»</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="products-tbody">
                            <tr>
                                <td>å¯çˆ±è·¯é£</td>
                                <td>Â¥2999.9</td>
                                <td>50</td>
                                <td>åŠ¨æ¼«</td>
                                <td><span class="status active">ä¸Šæ¶</span></td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="editProduct('1')">ç¼–è¾‘</button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteProduct('1')">åˆ é™¤</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ç”¨æˆ·ç®¡ç† -->
            <div id="users" class="admin-section">
                <div class="section-header">
                    <h2>ç”¨æˆ·ç®¡ç†</h2>
                </div>

                <div class="table-container">
                    <table id="users-table">
                        <thead>
                            <tr>
                                <th>é‚®ç®±</th>
                                <th>æ³¨å†Œæ—¶é—´</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="users-tbody">
                            <tr>
                                <td>test@example.com</td>
                                <td>2023-10-01</td>
                                <td><span class="status active">æ­£å¸¸</span></td>
                                <td>
                                    <button class="btn btn-sm btn-warning" onclick="toggleUserStatus('test@example.com')">ç¦ç”¨</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- è®¢å•ç®¡ç† -->
            <div id="orders" class="admin-section">
                <div class="section-header">
                    <h2>è®¢å•ç®¡ç†</h2>
                </div>

                <div class="table-container">
                    <table id="orders-table">
                        <thead>
                            <tr>
                                <th>è®¢å•å·</th>
                                <th>ç”¨æˆ·</th>
                                <th>é‡‘é¢</th>
                                <th>çŠ¶æ€</th>
                                <th>ä¸‹å•æ—¶é—´</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="orders-tbody">
                            <tr>
                                <td>ORD001</td>
                                <td>test@example.com</td>
                                <td>Â¥2999.9</td>
                                <td><span class="status paid">å·²æ”¯ä»˜</span></td>
                                <td>2023-10-21</td>
                                <td>
                                    <button class="btn btn-sm btn-info" onclick="viewOrder('ORD001')">æŸ¥çœ‹</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- è´¢åŠ¡ç®¡ç† -->
            <div id="finance" class="admin-section">
                <div class="section-header">
                    <h2>è´¢åŠ¡ç®¡ç†</h2>
                    <div>
                        <button class="btn btn-success" onclick="exportFinanceReport('csv')">å¯¼å‡ºCSV</button>
                        <button class="btn btn-info" onclick="exportFinanceReport('excel')">å¯¼å‡ºExcel</button>
                    </div>
                </div>

                <div class="finance-stats">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ’°</div>
                        <div class="stat-content">
                            <h3 id="today-revenue">Â¥1,234</h3>
                            <p>ä»Šæ—¥æ”¶å…¥</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“ˆ</div>
                        <div class="stat-content">
                            <h3 id="month-revenue">Â¥12,345</h3>
                            <p>æœ¬æœˆæ”¶å…¥</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ’³</div>
                        <div class="stat-content">
                            <h3 id="total-revenue-finance">Â¥123,456</h3>
                            <p>æ€»æ”¶å…¥</p>
                        </div>
                    </div>
                </div>

                <!-- æ”¶å…¥å›¾è¡¨åŒºåŸŸ -->
                <div class="charts-container">
                    <div class="chart-card">
                        <h3>æ”¶å…¥è¶‹åŠ¿å›¾</h3>
                        <canvas id="revenueChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>æ”¶å…¥æ¥æºåˆ†æ</h3>
                        <canvas id="revenueSourceChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- åº“å­˜ç®¡ç† -->
            <div id="inventory" class="admin-section">
                <div class="section-header">
                    <h2>åº“å­˜ç®¡ç†</h2>
                </div>

                <div class="inventory-alerts">
                    <h4>åº“å­˜é¢„è­¦</h4>
                    <p>ä»¥ä¸‹å•†å“åº“å­˜ä¸è¶³ï¼Œè¯·åŠæ—¶è¡¥è´§ï¼š</p>
                    <ul id="low-stock-list">
                        <li>å¯çˆ±è·¯é£ (åº“å­˜: 5)</li>
                    </ul>
                </div>

                <div class="table-container">
                    <table id="inventory-table">
                        <thead>
                            <tr>
                                <th>å•†å“åç§°</th>
                                <th>å½“å‰åº“å­˜</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-tbody">
                            <tr>
                                <td>å¯çˆ±è·¯é£</td>
                                <td>50</td>
                                <td><span class="status normal">æ­£å¸¸</span></td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="adjustStock('1')">è°ƒæ•´åº“å­˜</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ç²¾é€‰å•†å“ç®¡ç† -->
            <div id="featured" class="admin-section">
                <div class="section-header">
                    <h2>ç²¾é€‰å•†å“ç®¡ç†</h2>
                    <p>ç®¡ç†é¦–é¡µè½®æ’­å›¾å±•ç¤ºçš„ç²¾é€‰å•†å“</p>
                </div>

                <div class="featured-products-container">
                    <div class="section-header">
                    <h3>å½“å‰ç²¾é€‰å•†å“</h3>
                        <button class="btn btn-primary" onclick="showAddFeaturedForm()">æ·»åŠ ç²¾é€‰å•†å“</button>
                    </div>
                    <div id="featured-products-list" class="featured-grid">
                        <!-- ç²¾é€‰å•†å“å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                    </div>
                    </div>
                </div>

            <!-- å‘ç¥¨ç®¡ç† -->
            <div id="invoice" class="admin-section">
                <div class="section-header">
                    <h2>å‘ç¥¨ç®¡ç†</h2>
                    <div>
                        <button class="btn btn-primary" onclick="showCreateInvoiceForm()">å¼€å…·å‘ç¥¨</button>
                        <button class="btn btn-success" onclick="exportInvoiceReport('csv')">å¯¼å‡ºCSV</button>
                        <button class="btn btn-info" onclick="exportInvoiceReport('excel')">å¯¼å‡ºExcel</button>
                    </div>
                </div>

                <!-- æœç´¢å’Œç­›é€‰ -->
                <div class="filters">
                    <input type="text" id="invoice-search" placeholder="æœç´¢å‘ç¥¨ï¼ˆè®¢å•å·/ç”¨æˆ·é‚®ç®±ï¼‰..." onkeyup="handleInvoiceSearch(event)">
                    <select id="invoice-status-filter" onchange="handleInvoiceSearch()">
                        <option value="">æ‰€æœ‰çŠ¶æ€</option>
                        <option value="pending">å¾…å¼€å…·</option>
                        <option value="issued">å·²å¼€å…·</option>
                        <option value="cancelled">å·²ä½œåºŸ</option>
                    </select>
                    <button class="btn btn-primary" onclick="searchInvoices()">æœç´¢</button>
                    <button class="btn btn-secondary" onclick="resetInvoiceSearch()">é‡ç½®</button>
                </div>

                <!-- å‘ç¥¨åˆ—è¡¨ -->
                <div class="table-container">
                    <table id="invoices-table">
                        <thead>
                            <tr>
                                <th>å‘ç¥¨ç¼–å·</th>
                                <th>è®¢å•ç¼–å·</th>
                                <th>ç”¨æˆ·ä¿¡æ¯</th>
                                <th>å¼€ç¥¨é‡‘é¢</th>
                                <th>å¼€ç¥¨æ—¥æœŸ</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="invoices-tbody">
                            <tr>
                                <td>INV001</td>
                                <td>ORD001</td>
                                <td>test@example.com</td>
                                <td>Â¥2999.9</td>
                                <td>2023-10-21</td>
                                <td><span class="status issued">å·²å¼€å…·</span></td>
                                <td>
                                    <button class="btn btn-sm btn-info" onclick="viewInvoice('INV001')">æŸ¥çœ‹</button>
                                    <button class="btn btn-sm btn-success" onclick="downloadInvoice('INV001')">ä¸‹è½½</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ä¼˜æƒ åˆ¸ç®¡ç† -->
            <div id="coupon" class="admin-section">
                <div class="section-header">
                    <h2>ä¼˜æƒ åˆ¸ç®¡ç†</h2>
                    <div>
                        <button class="btn btn-primary" onclick="showCreateCouponForm()">æ–°å¢ä¼˜æƒ åˆ¸</button>
                        <button class="btn btn-success" onclick="exportCouponReport('csv')">å¯¼å‡ºCSV</button>
                        <button class="btn btn-info" onclick="exportCouponReport('excel')">å¯¼å‡ºExcel</button>
                    </div>
                </div>

                <!-- æœç´¢å’Œç­›é€‰ -->
                <div class="filters">
                    <input type="text" id="coupon-search" placeholder="æœç´¢ä¼˜æƒ åˆ¸ï¼ˆåç§°/ä»£ç ï¼‰..." onkeyup="handleCouponSearch(event)">
                    <select id="coupon-type-filter" onchange="handleCouponSearch()">
                        <option value="">æ‰€æœ‰ç±»å‹</option>
                        <option value="amount">æ»¡å‡</option>
                        <option value="discount">æŠ˜æ‰£</option>
                        <option value="shipping">åŒ…é‚®</option>
                    </select>
                    <select id="coupon-status-filter" onchange="handleCouponSearch()">
                        <option value="">æ‰€æœ‰çŠ¶æ€</option>
                        <option value="pending">æœªå¼€å§‹</option>
                        <option value="active">è¿›è¡Œä¸­</option>
                        <option value="expired">å·²è¿‡æœŸ</option>
                    </select>
                    <button class="btn btn-primary" onclick="searchCoupons()">æœç´¢</button>
                    <button class="btn btn-secondary" onclick="resetCouponSearch()">é‡ç½®</button>
                </div>

                <!-- ä¼˜æƒ åˆ¸åˆ—è¡¨ -->
                <div class="table-container">
                    <table id="coupons-table">
                        <thead>
                            <tr>
                                <th>ä¼˜æƒ åˆ¸åç§°</th>
                                <th>ä¼˜æƒ åˆ¸ä»£ç </th>
                                <th>ç±»å‹</th>
                                <th>é¢å€¼</th>
                                <th>ä½¿ç”¨æ¡ä»¶</th>
                                <th>æœ‰æ•ˆæœŸ</th>
                                <th>ä½¿ç”¨æ¬¡æ•°</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="coupons-tbody">
                            <!-- ä¼˜æƒ åˆ¸æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ å•†å“è¡¨å• -->
    <div id="add-product-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>æ·»åŠ å•†å“</h3>
            <form id="add-product-form">
                <input type="text" id="product-title" placeholder="å•†å“æ ‡é¢˜" required>
                <input type="number" id="product-price" placeholder="ä»·æ ¼" step="0.01" required>
                <input type="number" id="product-stock" placeholder="åº“å­˜æ•°é‡" required>
                <textarea id="product-description" placeholder="å•†å“æè¿°" required></textarea>
                <div class="file-upload-container">
                    <label for="product-image-file" class="file-upload-label">é€‰æ‹©å•†å“å›¾ç‰‡</label>
                    <input type="file" id="product-image-file" accept="image/*" onchange="handleImageUpload(this)">
                    <input type="text" id="product-image" placeholder="å›¾ç‰‡è·¯å¾„" required style="margin-top: 10px;">
                </div>
                <select id="product-category" required>
                    <option value="">é€‰æ‹©åˆ†ç±»</option>
                    <option value="anime">åŠ¨æ¼«</option>
                    <option value="game">æ¸¸æˆ</option>
                    <option value="other">å…¶ä»–</option>
                </select>
                <div style="display: flex; align-items: center; margin: 10px 0;">
                    <input type="checkbox" id="product-featured" style="width: auto; margin-right: 10px;">
                    <label for="product-featured">æ¨èå•†å“</label>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">æ·»åŠ å•†å“</button>
                    <button type="button" class="btn btn-secondary" onclick="closeAddProductForm()">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- æ·»åŠ ç²¾é€‰å•†å“è¡¨å• -->
    <div id="add-featured-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>æ·»åŠ ç²¾é€‰å•†å“</h3>
            <form id="add-featured-form">
                <select id="available-products" required>
                    <option value="">é€‰æ‹©å•†å“</option>
                </select>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">è®¾ä¸ºç²¾é€‰</button>
                    <button type="button" class="btn btn-secondary" onclick="closeAddFeaturedForm()">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- å¼€å…·å‘ç¥¨è¡¨å• -->
    <div id="create-invoice-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>å¼€å…·å‘ç¥¨</h3>
            <form id="create-invoice-form">
                <select id="invoice-order-select" required>
                    <option value="">é€‰æ‹©è®¢å•</option>
                </select>
                <input type="text" id="invoice-title" placeholder="å‘ç¥¨æŠ¬å¤´" required>
                <input type="text" id="invoice-tax-number" placeholder="ç¨å·" required>
                <input type="text" id="invoice-company" placeholder="å…¬å¸åç§°" required>
                <input type="text" id="invoice-address" placeholder="å…¬å¸åœ°å€" required>
                <select id="invoice-type" required>
                    <option value="">å¼€ç¥¨æ–¹å¼</option>
                    <option value="electronic">ç”µå­å‘ç¥¨</option>
                    <option value="paper">çº¸è´¨å‘ç¥¨</option>
                </select>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">ç¡®è®¤å¼€ç¥¨</button>
                    <button type="button" class="btn btn-secondary" onclick="closeCreateInvoiceForm()">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- å‘ç¥¨è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="invoice-detail-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>å‘ç¥¨è¯¦æƒ…</h3>
            <div id="invoice-detail-content">
                <!-- å‘ç¥¨è¯¦æƒ…å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>
            <div class="form-actions">
                <button class="btn btn-success" onclick="downloadInvoicePDF()">ä¸‹è½½PDF</button>
                <button class="btn btn-secondary" onclick="closeInvoiceDetail()">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- æ–°å¢ä¼˜æƒ åˆ¸è¡¨å• -->
    <div id="create-coupon-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>æ–°å¢ä¼˜æƒ åˆ¸</h3>
            <form id="create-coupon-form">
                <input type="text" id="coupon-name" placeholder="ä¼˜æƒ åˆ¸åç§°" required>
                <select id="coupon-type" required>
                    <option value="">é€‰æ‹©ç±»å‹</option>
                    <option value="amount">æ»¡å‡</option>
                    <option value="discount">æŠ˜æ‰£</option>
                    <option value="shipping">åŒ…é‚®</option>
                </select>
                <input type="number" id="coupon-value" placeholder="é¢å€¼" step="0.01" required>
                <input type="number" id="coupon-min-amount" placeholder="æœ€ä½æ¶ˆè´¹é‡‘é¢" step="0.01" value="0">
                <input type="datetime-local" id="coupon-start-date" required>
                <input type="datetime-local" id="coupon-end-date" required>
                <input type="number" id="coupon-total-quantity" placeholder="æ€»å‘æ”¾æ•°é‡" min="1" required>
                <div style="display: flex; align-items: center; margin: 10px 0;">
                    <input type="checkbox" id="coupon-stackable" style="width: auto; margin-right: 10px;">
                    <label for="coupon-stackable">å¯å åŠ ä½¿ç”¨</label>
                </div>
                <textarea id="coupon-description" placeholder="ä¼˜æƒ åˆ¸æè¿°"></textarea>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">åˆ›å»ºä¼˜æƒ åˆ¸</button>
                    <button type="button" class="btn btn-secondary" onclick="closeCreateCouponForm()">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentSection = 'dashboard';

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ç®¡ç†åå°é¡µé¢åˆå§‹åŒ–...');
            updateTime();
            setInterval(updateTime, 1000);
            
            // ç¡®ä¿æ‰€æœ‰éƒ¨åˆ†éƒ½éšè—ï¼Œç„¶åæ˜¾ç¤ºä»ªè¡¨ç›˜
            document.querySelectorAll('.admin-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // æ˜¾ç¤ºä»ªè¡¨ç›˜
            const dashboardSection = document.getElementById('dashboard');
            if (dashboardSection) {
                dashboardSection.classList.add('active');
            }
            
            // æ¿€æ´»ä»ªè¡¨ç›˜å¯¼èˆªé¡¹
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            const dashboardNav = document.querySelector('[onclick="showSection(\'dashboard\')"]');
            if (dashboardNav) {
                dashboardNav.classList.add('active');
            }
            
            // åˆå§‹åŒ–å›¾è¡¨
            initCharts();
        });

        // æ›´æ–°æ—¶é—´
        function updateTime() {
            const now = new Date();
            const timeElement = document.getElementById('current-time');
            if (timeElement) {
                timeElement.textContent = now.toLocaleString('zh-CN');
            }
        }

        // æ˜¾ç¤ºæŒ‡å®šéƒ¨åˆ†
        function showSection(sectionId) {
            console.log('åˆ‡æ¢åˆ°éƒ¨åˆ†:', sectionId);
            
            try {
                // éšè—æ‰€æœ‰éƒ¨åˆ†
                document.querySelectorAll('.admin-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // ç§»é™¤æ‰€æœ‰å¯¼èˆªé¡¹çš„æ´»åŠ¨çŠ¶æ€
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // æ˜¾ç¤ºæŒ‡å®šéƒ¨åˆ†
                const targetSection = document.getElementById(sectionId);
                if (targetSection) {
                    targetSection.classList.add('active');
                    console.log('æ˜¾ç¤ºéƒ¨åˆ†:', sectionId);
                } else {
                    console.error('æ‰¾ä¸åˆ°éƒ¨åˆ†:', sectionId);
                    alert('æ‰¾ä¸åˆ°å¯¹åº”çš„åŠŸèƒ½é¡µé¢');
                    return;
                }
                
                // æ¿€æ´»å¯¹åº”çš„å¯¼èˆªé¡¹
                const navItem = document.querySelector(`[onclick="showSection('${sectionId}')"]`);
                if (navItem) {
                    navItem.classList.add('active');
                    console.log('å¯¼èˆªé¡¹å·²æ¿€æ´»:', sectionId);
                }
                
                currentSection = sectionId;
                
                // æ ¹æ®éƒ¨åˆ†åŠ è½½ç›¸åº”æ•°æ®
                switch(sectionId) {
                    case 'dashboard':
                        console.log('åŠ è½½ä»ªè¡¨ç›˜æ•°æ®...');
                        break;
                    case 'products':
                        console.log('åŠ è½½å•†å“æ•°æ®...');
                        loadProducts();
                        break;
                    case 'users':
                        console.log('åŠ è½½ç”¨æˆ·æ•°æ®...');
                        break;
                    case 'orders':
                        console.log('åŠ è½½è®¢å•æ•°æ®...');
                        break;
                    case 'finance':
                        console.log('åŠ è½½è´¢åŠ¡æ•°æ®...');
                        initFinanceCharts();
                        break;
                    case 'inventory':
                        console.log('åŠ è½½åº“å­˜æ•°æ®...');
                        loadInventoryData();
                        break;
                    case 'featured':
                        console.log('åŠ è½½ç²¾é€‰å•†å“æ•°æ®...');
                        loadFeaturedProducts();
                        break;
                    case 'invoice':
                        console.log('åŠ è½½å‘ç¥¨æ•°æ®...');
                        loadInvoices();
                        break;
                    case 'coupon':
                        console.log('åŠ è½½ä¼˜æƒ åˆ¸æ•°æ®...');
                        loadCoupons();
                        break;
                    default:
                        console.warn('æœªçŸ¥çš„éƒ¨åˆ†:', sectionId);
                }
            } catch (error) {
                console.error('åˆ‡æ¢éƒ¨åˆ†æ—¶å‡ºé”™:', error);
                alert('åˆ‡æ¢é¡µé¢æ—¶å‡ºé”™: ' + error.message);
            }
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initCharts() {
            try {
                console.log('å¼€å§‹åˆå§‹åŒ–å›¾è¡¨...');
                
                // æ£€æŸ¥Chart.jsæ˜¯å¦åŠ è½½
                if (typeof Chart === 'undefined') {
                    console.error('Chart.jsæœªåŠ è½½');
                    return;
                }
                
            // é”€å”®è¶‹åŠ¿å›¾
                const salesCanvas = document.getElementById('salesChart');
                if (salesCanvas) {
                    const salesCtx = salesCanvas.getContext('2d');
            new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'],
                    datasets: [{
                        label: 'é”€å”®é¢',
                        data: [12000, 19000, 15000, 25000, 22000, 30000],
                        borderColor: 'rgb(75, 192, 192)',
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                tension: 0.1,
                                fill: true
                    }]
                },
                options: {
                    responsive: true,
                            maintainAspectRatio: false,
                            aspectRatio: 1.2,
                    scales: {
                        y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return 'Â¥' + value.toLocaleString();
                                        }
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    position: 'top'
                                }
                            },
                            layout: {
                                padding: {
                                    top: 10,
                                    bottom: 10,
                                    left: 10,
                                    right: 10
                        }
                    }
                }
            });
                    console.log('é”€å”®è¶‹åŠ¿å›¾åˆå§‹åŒ–å®Œæˆ');
                }

            // åˆ†ç±»ç»Ÿè®¡å›¾
                const categoryCanvas = document.getElementById('categoryChart');
                if (categoryCanvas) {
                    const categoryCtx = categoryCanvas.getContext('2d');
            new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: ['åŠ¨æ¼«', 'æ¸¸æˆ', 'å…¶ä»–'],
                    datasets: [{
                        data: [6, 2, 2],
                        backgroundColor: [
                            'rgb(255, 99, 132)',
                            'rgb(54, 162, 235)',
                            'rgb(255, 205, 86)'
                                ],
                                borderWidth: 2,
                                borderColor: '#fff'
                    }]
                },
                options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            aspectRatio: 1.2,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            },
                            layout: {
                                padding: {
                                    top: 10,
                                    bottom: 10,
                                    left: 10,
                                    right: 10
                                }
                            }
                        }
                    });
                    console.log('åˆ†ç±»ç»Ÿè®¡å›¾åˆå§‹åŒ–å®Œæˆ');
                }
                
                console.log('å›¾è¡¨åˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                console.error('å›¾è¡¨åˆå§‹åŒ–å¤±è´¥:', error);
            }
        }

        // å•†å“ç®¡ç†åŠŸèƒ½
        async function loadProducts() {
            try {
                console.log('åŠ è½½å•†å“æ•°æ®...');
                const response = await fetch('http://localhost:5001/api/products');
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        displayProducts(data.data);
                    }
                }
            } catch (error) {
                console.error('åŠ è½½å•†å“å¤±è´¥:', error);
            }
        }

        function displayProducts(products) {
            const tbody = document.getElementById('products-tbody');
            tbody.innerHTML = '';

            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.title}</td>
                    <td>Â¥${product.price}</td>
                    <td>${product.stock}</td>
                    <td>${getCategoryName(product.category)}</td>
                    <td><span class="status ${product.isActive ? 'active' : 'inactive'}">${product.isActive ? 'ä¸Šæ¶' : 'ä¸‹æ¶'}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="editProduct('${product._id}')">ç¼–è¾‘</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteProduct('${product._id}')">åˆ é™¤</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function getCategoryName(category) {
            const categoryMap = {
                'anime': 'åŠ¨æ¼«',
                'game': 'æ¸¸æˆ',
                'other': 'å…¶ä»–'
            };
            return categoryMap[category] || category;
        }

        // å•†å“æœç´¢åŠŸèƒ½
        async function searchProducts() {
            try {
                const searchTerm = document.getElementById('product-search').value;
                const category = document.getElementById('category-filter').value;
                
                let url = 'http://localhost:5001/api/products?';
                const params = new URLSearchParams();
                
                if (searchTerm) {
                    params.append('search', searchTerm);
                }
                if (category) {
                    params.append('category', category);
                }
                
                url += params.toString();
                
                console.log('æœç´¢å•†å“:', url);
                const response = await fetch(url);
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        displayProducts(data.data);
                    }
                }
            } catch (error) {
                console.error('æœç´¢å•†å“å¤±è´¥:', error);
            }
        }

        // å¤„ç†å•†å“æœç´¢è¾“å…¥
        function handleProductSearch(event) {
            if (event && event.key === 'Enter') {
                searchProducts();
            } else if (!event) {
                searchProducts();
            }
        }

        // é‡ç½®å•†å“æœç´¢
        function resetProductSearch() {
            document.getElementById('product-search').value = '';
            document.getElementById('category-filter').value = '';
            loadProducts();
        }

        function showAddProductForm() {
            document.getElementById('add-product-modal').style.display = 'block';
        }

        function closeAddProductForm() {
            document.getElementById('add-product-modal').style.display = 'none';
            const form = document.getElementById('add-product-form');
            if (form) {
                form.reset();
                // é‡ç½®è¡¨å•æ ‡é¢˜
                const titleElement = document.getElementById('add-product-modal').querySelector('h3');
                if (titleElement) {
                    titleElement.textContent = 'æ·»åŠ å•†å“';
                }
            }
        }

        // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
        function handleImageUpload(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('product-image').value = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        // æ˜¾ç¤ºæ·»åŠ ç²¾é€‰å•†å“è¡¨å•
        async function showAddFeaturedForm() {
            try {
                const response = await fetch('http://localhost:5001/api/products');
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        const select = document.getElementById('available-products');
                        select.innerHTML = '<option value="">é€‰æ‹©å•†å“</option>';
                        
                        data.data.forEach(product => {
                            const option = document.createElement('option');
                            option.value = product._id;
                            option.textContent = product.title;
                            select.appendChild(option);
                        });
                    }
                }
            } catch (error) {
                console.error('åŠ è½½å•†å“åˆ—è¡¨å¤±è´¥:', error);
            }
            
            document.getElementById('add-featured-modal').style.display = 'block';
        }

        function closeAddFeaturedForm() {
            document.getElementById('add-featured-modal').style.display = 'none';
        }

        // å¤„ç†æ·»åŠ ç²¾é€‰å•†å“è¡¨å•æäº¤
        document.addEventListener('DOMContentLoaded', function() {
            const addFeaturedForm = document.getElementById('add-featured-form');
            if (addFeaturedForm) {
                addFeaturedForm.addEventListener('submit', async function(e) {
            e.preventDefault();
                    const productId = document.getElementById('available-products').value;
                    if (productId) {
                        try {
                            const response = await fetch(`http://localhost:5001/api/products/${productId}`, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                                },
                                body: JSON.stringify({ isFeatured: true })
                            });
                            if (response.ok) {
                                alert('å•†å“å·²è®¾ä¸ºç²¾é€‰ï¼');
                                closeAddFeaturedForm();
                                loadFeaturedProducts();
                            } else {
                                alert('è®¾ç½®å¤±è´¥ï¼Œè¯·é‡è¯•');
                            }
                        } catch (error) {
                            console.error('è®¾ç½®ç²¾é€‰å•†å“å¤±è´¥:', error);
                            alert('è®¾ç½®å¤±è´¥ï¼Œè¯·é‡è¯•');
                        }
                    }
                });
            }

            // å¤„ç†æ·»åŠ å•†å“è¡¨å•æäº¤
            const addProductForm = document.getElementById('add-product-form');
            if (addProductForm) {
                addProductForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
            const productData = {
                title: document.getElementById('product-title').value,
                price: parseFloat(document.getElementById('product-price').value),
                stock: parseInt(document.getElementById('product-stock').value),
                description: document.getElementById('product-description').value,
                image: document.getElementById('product-image').value,
                category: document.getElementById('product-category').value,
                isFeatured: document.getElementById('product-featured').checked
            };

            try {
                        console.log('å‘é€å•†å“æ•°æ®:', productData);
                        const response = await fetch('http://localhost:5001/api/products', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('token')}`
                            },
                            body: JSON.stringify(productData)
                        });

                        console.log('å“åº”çŠ¶æ€:', response.status);
                        const result = await response.json();
                        console.log('å“åº”æ•°æ®:', result);

                        if (response.ok && result.success) {
                        alert('å•†å“æ·»åŠ æˆåŠŸï¼');
                            closeAddProductForm();
                            loadProducts(); // é‡æ–°åŠ è½½å•†å“åˆ—è¡¨
                    } else {
                            alert('æ·»åŠ å¤±è´¥: ' + (result.message || 'è¯·é‡è¯•'));
                        }
                    } catch (error) {
                        console.error('æ·»åŠ å•†å“å¤±è´¥:', error);
                        alert('æ·»åŠ å¤±è´¥: ' + error.message);
                    }
                });
            }

            // å¤„ç†åˆ›å»ºä¼˜æƒ åˆ¸è¡¨å•æäº¤
            const createCouponForm = document.getElementById('create-coupon-form');
            if (createCouponForm) {
                createCouponForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const couponData = {
                        name: document.getElementById('coupon-name').value,
                        type: document.getElementById('coupon-type').value,
                        value: parseFloat(document.getElementById('coupon-value').value),
                        minAmount: parseFloat(document.getElementById('coupon-min-amount').value) || 0,
                        startDate: document.getElementById('coupon-start-date').value,
                        endDate: document.getElementById('coupon-end-date').value,
                        totalQuantity: parseInt(document.getElementById('coupon-total-quantity').value),
                        stackable: document.getElementById('coupon-stackable').checked,
                        description: document.getElementById('coupon-description').value
                    };

                    try {
                        console.log('å‘é€ä¼˜æƒ åˆ¸æ•°æ®:', couponData);
                        const response = await fetch('http://localhost:5001/api/coupons', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('token')}`
                            },
                            body: JSON.stringify(couponData)
                        });

                        console.log('å“åº”çŠ¶æ€:', response.status);
                        const result = await response.json();
                        console.log('å“åº”æ•°æ®:', result);

                        if (response.ok && result.success) {
                            alert('ä¼˜æƒ åˆ¸åˆ›å»ºæˆåŠŸï¼');
                            closeCreateCouponForm();
                            loadCoupons(); // é‡æ–°åŠ è½½ä¼˜æƒ åˆ¸åˆ—è¡¨
                        } else {
                            alert('åˆ›å»ºå¤±è´¥: ' + (result.message || 'è¯·é‡è¯•'));
                }
            } catch (error) {
                        console.error('åˆ›å»ºä¼˜æƒ åˆ¸å¤±è´¥:', error);
                        alert('åˆ›å»ºå¤±è´¥: ' + error.message);
                    }
                });
            }
        });

        async function editProduct(productId) {
            try {
                const response = await fetch(`http://localhost:5001/api/products/${productId}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        const product = data.data;
            
            // å¡«å……ç¼–è¾‘è¡¨å•
            document.getElementById('product-title').value = product.title;
            document.getElementById('product-price').value = product.price;
            document.getElementById('product-stock').value = product.stock;
            document.getElementById('product-description').value = product.description;
            document.getElementById('product-image').value = product.image;
            document.getElementById('product-category').value = product.category;
            document.getElementById('product-featured').checked = product.isFeatured;
            
            // æ˜¾ç¤ºç¼–è¾‘è¡¨å•
            document.getElementById('add-product-modal').style.display = 'block';
                        document.getElementById('add-product-modal').querySelector('h3').textContent = 'ç¼–è¾‘å•†å“';
                        
                        // æ¸…é™¤ä¹‹å‰çš„è¡¨å•äº‹ä»¶ç›‘å¬å™¨
                        const form = document.getElementById('add-product-form');
                        const newForm = form.cloneNode(true);
                        form.parentNode.replaceChild(newForm, form);
                        
                        // æ·»åŠ ä¿å­˜æŒ‰é’®äº‹ä»¶
                        newForm.onsubmit = async function(e) {
                            e.preventDefault();
                            await saveProduct(productId);
                        };
                    }
                    }
                } catch (error) {
                console.error('åŠ è½½å•†å“è¯¦æƒ…å¤±è´¥:', error);
                alert('åŠ è½½å•†å“è¯¦æƒ…å¤±è´¥');
            }
        }

        async function saveProduct(productId) {
            try {
                const productData = {
                    title: document.getElementById('product-title').value,
                    price: parseFloat(document.getElementById('product-price').value),
                    stock: parseInt(document.getElementById('product-stock').value),
                    description: document.getElementById('product-description').value,
                    image: document.getElementById('product-image').value,
                    category: document.getElementById('product-category').value,
                    isFeatured: document.getElementById('product-featured').checked
                };

                const response = await fetch(`http://localhost:5001/api/products/${productId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify(productData)
                });

                if (response.ok) {
                    alert('å•†å“æ›´æ–°æˆåŠŸï¼');
                    closeAddProductForm();
                    loadProducts(); // é‡æ–°åŠ è½½å•†å“åˆ—è¡¨
                } else {
                    const result = await response.json();
                    alert('æ›´æ–°å¤±è´¥: ' + (result.message || 'è¯·é‡è¯•'));
                }
            } catch (error) {
                console.error('æ›´æ–°å•†å“å¤±è´¥:', error);
                alert('æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        async function deleteProduct(productId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå•†å“å—ï¼Ÿ')) {
                try {
                    const response = await fetch(`http://localhost:5001/api/products/${productId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        }
                    });
                    if (response.ok) {
                        alert('å•†å“åˆ é™¤æˆåŠŸï¼');
                        loadProducts(); // é‡æ–°åŠ è½½å•†å“åˆ—è¡¨
                    } else {
                        alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•');
                    }
                } catch (error) {
                    console.error('åˆ é™¤å•†å“å¤±è´¥:', error);
                    alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            }
        }

        // ç”¨æˆ·ç®¡ç†åŠŸèƒ½
        function toggleUserStatus(email) {
            alert('åˆ‡æ¢ç”¨æˆ·çŠ¶æ€: ' + email);
        }

        // è®¢å•ç®¡ç†åŠŸèƒ½
        function viewOrder(orderId) {
            alert('æŸ¥çœ‹è®¢å•: ' + orderId);
        }

        // é€šç”¨å¯¼å‡ºåŠŸèƒ½
        function exportToCSV(data, filename) {
            if (!data || data.length === 0) {
                alert('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º');
                return;
            }
            
            const headers = Object.keys(data[0]);
            const csvContent = [
                headers.join(','),
                ...data.map(row => headers.map(header => `"${row[header] || ''}"`).join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportToExcel(data, filename) {
            if (!data || data.length === 0) {
                alert('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º');
                return;
            }
            
            // ç®€å•çš„Excelæ ¼å¼ï¼ˆCSVæ ¼å¼ï¼Œä½†æ‰©å±•åä¸º.xlsxï¼‰
            const headers = Object.keys(data[0]);
            const csvContent = [
                headers.join('\t'),
                ...data.map(row => headers.map(header => row[header] || '').join('\t'))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'application/vnd.ms-excel;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // è´¢åŠ¡ç®¡ç†åŠŸèƒ½
        function exportFinanceReport(format) {
            try {
                // æ¨¡æ‹Ÿè´¢åŠ¡æ•°æ®
                const financeData = [
                    { date: '2023-10-01', revenue: 12000, orders: 15 },
                    { date: '2023-10-02', revenue: 15000, orders: 18 },
                    { date: '2023-10-03', revenue: 18000, orders: 22 },
                    { date: '2023-10-04', revenue: 14000, orders: 16 },
                    { date: '2023-10-05', revenue: 16000, orders: 20 }
                ];
                
                if (format === 'csv') {
                    exportToCSV(financeData, 'è´¢åŠ¡æŠ¥å‘Š.csv');
                } else if (format === 'excel') {
                    exportToExcel(financeData, 'è´¢åŠ¡æŠ¥å‘Š.xlsx');
                }
            } catch (error) {
                console.error('å¯¼å‡ºè´¢åŠ¡æŠ¥å‘Šå¤±è´¥:', error);
                alert('å¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        // åˆå§‹åŒ–è´¢åŠ¡å›¾è¡¨
        function initFinanceCharts() {
            try {
            // æ”¶å…¥è¶‹åŠ¿å›¾
                const revenueCanvas = document.getElementById('revenueChart');
                if (revenueCanvas && typeof Chart !== 'undefined') {
                    const revenueCtx = revenueCanvas.getContext('2d');
            new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ'],
                    datasets: [{
                        label: 'æœˆæ”¶å…¥',
                        data: [8000, 12000, 15000, 18000, 22000, 25000, 28000, 30000, 32000, 35000],
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                            maintainAspectRatio: false,
                            aspectRatio: 1.2,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'Â¥' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                                legend: {
                                    position: 'top'
                                }
                            },
                            layout: {
                                padding: {
                                    top: 10,
                                    bottom: 10,
                                    left: 10,
                                    right: 10
                        }
                    }
                }
            });
                }

            // æ”¶å…¥æ¥æºåˆ†æå›¾
                const sourceCanvas = document.getElementById('revenueSourceChart');
                if (sourceCanvas && typeof Chart !== 'undefined') {
                    const sourceCtx = sourceCanvas.getContext('2d');
            new Chart(sourceCtx, {
                type: 'doughnut',
                data: {
                    labels: ['å•†å“é”€å”®', 'ä¼šå‘˜è´¹', 'å¹¿å‘Šæ”¶å…¥'],
                    datasets: [{
                        data: [85000, 25000, 15000],
                        backgroundColor: [
                            'rgb(255, 99, 132)',
                            'rgb(54, 162, 235)',
                            'rgb(255, 205, 86)'
                        ],
                                borderWidth: 2,
                                borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                            maintainAspectRatio: false,
                            aspectRatio: 1.2,
                    plugins: {
                        legend: {
                            position: 'bottom'
                                }
                            },
                            layout: {
                                padding: {
                                    top: 10,
                                    bottom: 10,
                                    left: 10,
                                    right: 10
                        }
                    }
                }
            });
        }
            } catch (error) {
                console.error('è´¢åŠ¡å›¾è¡¨åˆå§‹åŒ–å¤±è´¥:', error);
            }
        }

        // åº“å­˜ç®¡ç†åŠŸèƒ½
        async function loadInventoryData() {
            try {
                const response = await fetch('http://localhost:5001/api/products');
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        displayInventory(data.data);
                    }
                }
            } catch (error) {
                console.error('åŠ è½½åº“å­˜æ•°æ®å¤±è´¥:', error);
            }
        }

        function displayInventory(products) {
            const tbody = document.getElementById('inventory-tbody');
            const lowStockList = document.getElementById('low-stock-list');
            tbody.innerHTML = '';
            lowStockList.innerHTML = '';

            let hasLowStock = false;

            products.forEach(product => {
                const row = document.createElement('tr');
                const stockStatus = product.stock < 10 ? 'low' : 'normal';
                const statusText = product.stock < 10 ? 'åº“å­˜ä¸è¶³' : 'æ­£å¸¸';
                
                row.innerHTML = `
                    <td>${product.title}</td>
                    <td>${product.stock}</td>
                    <td><span class="status ${stockStatus}">${statusText}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="adjustStock('${product._id}')">è°ƒæ•´åº“å­˜</button>
                    </td>
                `;
                tbody.appendChild(row);

                // æ·»åŠ åˆ°åº“å­˜é¢„è­¦åˆ—è¡¨
                if (product.stock < 10) {
                    hasLowStock = true;
                    const alertItem = document.createElement('li');
                    alertItem.textContent = `${product.title} (åº“å­˜: ${product.stock})`;
                    lowStockList.appendChild(alertItem);
                }
            });

            // å¦‚æœæ²¡æœ‰åº“å­˜ä¸è¶³çš„å•†å“ï¼Œæ˜¾ç¤ºæç¤º
            if (!hasLowStock) {
                const noAlertItem = document.createElement('li');
                noAlertItem.textContent = 'æš‚æ— åº“å­˜ä¸è¶³çš„å•†å“';
                noAlertItem.style.color = '#28a745';
                lowStockList.appendChild(noAlertItem);
            }
        }

        async function adjustStock(productId) {
            const newStock = prompt('è¯·è¾“å…¥æ–°çš„åº“å­˜æ•°é‡:');
            if (newStock && !isNaN(newStock)) {
                try {
                    const response = await fetch(`http://localhost:5001/api/products/${productId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        },
                        body: JSON.stringify({ stock: parseInt(newStock) })
                    });
                    if (response.ok) {
                        alert('åº“å­˜è°ƒæ•´æˆåŠŸï¼');
                        loadInventoryData(); // é‡æ–°åŠ è½½åº“å­˜æ•°æ®
                    } else {
                        alert('åº“å­˜è°ƒæ•´å¤±è´¥ï¼Œè¯·é‡è¯•');
                    }
                } catch (error) {
                    console.error('è°ƒæ•´åº“å­˜å¤±è´¥:', error);
                    alert('åº“å­˜è°ƒæ•´å¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            }
        }

        // ç²¾é€‰å•†å“ç®¡ç†åŠŸèƒ½
        async function loadFeaturedProducts() {
            try {
                const response = await fetch('http://localhost:5001/api/products?featured=true');
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        displayFeaturedProducts(data.data);
                    }
                }
            } catch (error) {
                console.error('åŠ è½½ç²¾é€‰å•†å“å¤±è´¥:', error);
            }
        }

        function displayFeaturedProducts(products) {
            const container = document.getElementById('featured-products-list');
            container.innerHTML = '';

            products.forEach(product => {
                const item = document.createElement('div');
                item.className = 'featured-product-item';
                item.innerHTML = `
                    <img src="${product.image}" alt="${product.title}">
                    <div class="featured-product-info">
                        <h4>${product.title}</h4>
                        <p>Â¥${product.price}</p>
                        <button class="btn btn-danger btn-sm" onclick="removeFromFeatured('${product._id}')">ç§»é™¤ç²¾é€‰</button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        async function removeFromFeatured(productId) {
            if (confirm('ç¡®å®šè¦ç§»é™¤è¿™ä¸ªç²¾é€‰å•†å“å—ï¼Ÿ')) {
                try {
                    const response = await fetch(`http://localhost:5001/api/products/${productId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        },
                        body: JSON.stringify({ isFeatured: false })
                    });
                    if (response.ok) {
                        alert('å•†å“å·²ä»ç²¾é€‰åˆ—è¡¨ä¸­ç§»é™¤ï¼');
                        loadFeaturedProducts(); // é‡æ–°åŠ è½½ç²¾é€‰å•†å“
                    } else {
                        alert('ç§»é™¤å¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            } catch (error) {
                    console.error('ç§»é™¤ç²¾é€‰å•†å“å¤±è´¥:', error);
                    alert('ç§»é™¤å¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            }
        }

        // å‘ç¥¨ç®¡ç†åŠŸèƒ½
        function loadInvoices() {
            console.log('åŠ è½½å‘ç¥¨æ•°æ®...');
            // æ¨¡æ‹Ÿå‘ç¥¨æ•°æ®
            const mockInvoices = [
                {
                    _id: '1',
                    invoiceNumber: 'INV001',
                    orderNumber: 'ORD001',
                    userEmail: 'test@example.com',
                    amount: 2999.9,
                    date: '2023-10-21',
                    status: 'issued'
                },
                {
                    _id: '2',
                    invoiceNumber: 'INV002',
                    orderNumber: 'ORD002',
                    userEmail: 'user@example.com',
                    amount: 1599.9,
                    date: '2023-10-22',
                    status: 'pending'
                }
            ];
            displayInvoices(mockInvoices);
        }

        // å‘ç¥¨æœç´¢åŠŸèƒ½
        function searchInvoices() {
            const searchTerm = document.getElementById('invoice-search').value.toLowerCase();
            const statusFilter = document.getElementById('invoice-status-filter').value;
            
            // æ¨¡æ‹Ÿå‘ç¥¨æ•°æ®
            let mockInvoices = [
                {
                    _id: '1',
                    invoiceNumber: 'INV001',
                    orderNumber: 'ORD001',
                    userEmail: 'test@example.com',
                    amount: 2999.9,
                    date: '2023-10-21',
                    status: 'issued'
                },
                {
                    _id: '2',
                    invoiceNumber: 'INV002',
                    orderNumber: 'ORD002',
                    userEmail: 'user@example.com',
                    amount: 1599.9,
                    date: '2023-10-22',
                    status: 'pending'
                },
                {
                    _id: '3',
                    invoiceNumber: 'INV003',
                    orderNumber: 'ORD003',
                    userEmail: 'admin@example.com',
                    amount: 899.9,
                    date: '2023-10-23',
                    status: 'cancelled'
                }
            ];

            // åº”ç”¨æœç´¢è¿‡æ»¤
            let filteredInvoices = mockInvoices;
            
            if (searchTerm) {
                filteredInvoices = filteredInvoices.filter(invoice => 
                    invoice.invoiceNumber.toLowerCase().includes(searchTerm) ||
                    invoice.orderNumber.toLowerCase().includes(searchTerm) ||
                    invoice.userEmail.toLowerCase().includes(searchTerm)
                );
            }
            
            if (statusFilter) {
                filteredInvoices = filteredInvoices.filter(invoice => 
                    invoice.status === statusFilter
                );
            }
            
            displayInvoices(filteredInvoices);
        }

        // å¤„ç†å‘ç¥¨æœç´¢è¾“å…¥
        function handleInvoiceSearch(event) {
            if (event && event.key === 'Enter') {
                searchInvoices();
            } else if (!event) {
                searchInvoices();
            }
        }

        // é‡ç½®å‘ç¥¨æœç´¢
        function resetInvoiceSearch() {
            document.getElementById('invoice-search').value = '';
            document.getElementById('invoice-status-filter').value = '';
            loadInvoices();
        }

        // æ˜¾ç¤ºå‘ç¥¨åˆ—è¡¨
        function displayInvoices(invoices) {
            const tbody = document.getElementById('invoices-tbody');
            tbody.innerHTML = '';

            if (invoices.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #666;">æš‚æ— å‘ç¥¨æ•°æ®</td></tr>';
                return;
            }

            invoices.forEach(invoice => {
                const row = document.createElement('tr');
                const statusText = getInvoiceStatusText(invoice.status);
                const statusClass = getInvoiceStatusClass(invoice.status);
                
                row.innerHTML = `
                    <td>${invoice.invoiceNumber}</td>
                    <td>${invoice.orderNumber}</td>
                    <td>${invoice.userEmail}</td>
                    <td>Â¥${invoice.amount}</td>
                    <td>${invoice.date}</td>
                    <td><span class="status ${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="viewInvoice('${invoice._id}')">æŸ¥çœ‹</button>
                        <button class="btn btn-sm btn-success" onclick="downloadInvoice('${invoice._id}')">ä¸‹è½½</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function getInvoiceStatusText(status) {
            const statusMap = {
                'pending': 'å¾…å¼€å…·',
                'issued': 'å·²å¼€å…·',
                'cancelled': 'å·²ä½œåºŸ'
            };
            return statusMap[status] || status;
        }

        function getInvoiceStatusClass(status) {
            const classMap = {
                'pending': 'pending',
                'issued': 'success',
                'cancelled': 'failed'
            };
            return classMap[status] || 'pending';
        }

        function showCreateInvoiceForm() {
            document.getElementById('create-invoice-modal').style.display = 'block';
        }

        function closeCreateInvoiceForm() {
            document.getElementById('create-invoice-modal').style.display = 'none';
            document.getElementById('create-invoice-form').reset();
        }

        function viewInvoice(invoiceId) {
            document.getElementById('invoice-detail-modal').style.display = 'block';
            // è¿™é‡Œå¯ä»¥æ·»åŠ åŠ è½½å‘ç¥¨è¯¦æƒ…çš„é€»è¾‘
        }

        function closeInvoiceDetail() {
            document.getElementById('invoice-detail-modal').style.display = 'none';
        }

        function downloadInvoice(invoiceId) {
            alert('ä¸‹è½½å‘ç¥¨: ' + invoiceId);
        }

        function downloadInvoicePDF() {
            alert('ä¸‹è½½PDFå‘ç¥¨');
        }

        function exportInvoiceReport(format) {
            try {
                // è·å–å½“å‰æ˜¾ç¤ºçš„å‘ç¥¨æ•°æ®
                const invoiceRows = document.querySelectorAll('#invoices-tbody tr');
                const invoiceData = [];
                
                invoiceRows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length >= 6) {
                        invoiceData.push({
                            invoiceNumber: cells[0].textContent,
                            orderNumber: cells[1].textContent,
                            userEmail: cells[2].textContent,
                            amount: cells[3].textContent,
                            date: cells[4].textContent,
                            status: cells[5].textContent.trim()
                        });
                    }
                });
                
                if (invoiceData.length === 0) {
                    alert('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º');
                    return;
                }
                
                if (format === 'csv') {
                    exportToCSV(invoiceData, 'å‘ç¥¨æŠ¥å‘Š.csv');
                } else if (format === 'excel') {
                    exportToExcel(invoiceData, 'å‘ç¥¨æŠ¥å‘Š.xlsx');
                }
            } catch (error) {
                console.error('å¯¼å‡ºå‘ç¥¨æŠ¥å‘Šå¤±è´¥:', error);
                alert('å¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        // ä¼˜æƒ åˆ¸ç®¡ç†åŠŸèƒ½
        async function loadCoupons() {
            try {
                console.log('åŠ è½½ä¼˜æƒ åˆ¸æ•°æ®...');
                const response = await fetch('http://localhost:5001/api/coupons', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        displayCoupons(data.data);
                    } else {
                        console.error('åŠ è½½ä¼˜æƒ åˆ¸å¤±è´¥:', data.message);
                        displayCoupons([]);
                    }
                } else {
                    console.error('åŠ è½½ä¼˜æƒ åˆ¸å¤±è´¥ï¼ŒçŠ¶æ€ç :', response.status);
                    displayCoupons([]);
                }
            } catch (error) {
                console.error('åŠ è½½ä¼˜æƒ åˆ¸å¤±è´¥:', error);
                displayCoupons([]);
            }
        }

        // ä¼˜æƒ åˆ¸æœç´¢åŠŸèƒ½
        async function searchCoupons() {
            try {
                const searchTerm = document.getElementById('coupon-search').value;
                const typeFilter = document.getElementById('coupon-type-filter').value;
                const statusFilter = document.getElementById('coupon-status-filter').value;
                
                let url = 'http://localhost:5001/api/coupons?';
                const params = new URLSearchParams();
                
                if (searchTerm) {
                    params.append('search', searchTerm);
                }
                if (typeFilter) {
                    params.append('type', typeFilter);
                }
                if (statusFilter) {
                    params.append('status', statusFilter);
                }
                
                url += params.toString();
                
                console.log('æœç´¢ä¼˜æƒ åˆ¸:', url);
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        displayCoupons(data.data);
                    } else {
                        console.error('æœç´¢ä¼˜æƒ åˆ¸å¤±è´¥:', data.message);
                        displayCoupons([]);
                    }
                } else {
                    console.error('æœç´¢ä¼˜æƒ åˆ¸å¤±è´¥ï¼ŒçŠ¶æ€ç :', response.status);
                    displayCoupons([]);
                }
            } catch (error) {
                console.error('æœç´¢ä¼˜æƒ åˆ¸å¤±è´¥:', error);
                displayCoupons([]);
            }
        }

        // å¤„ç†ä¼˜æƒ åˆ¸æœç´¢è¾“å…¥
        function handleCouponSearch(event) {
            if (event && event.key === 'Enter') {
                searchCoupons();
            } else if (!event) {
                searchCoupons();
            }
        }

        // é‡ç½®ä¼˜æƒ åˆ¸æœç´¢
        function resetCouponSearch() {
            document.getElementById('coupon-search').value = '';
            document.getElementById('coupon-type-filter').value = '';
            document.getElementById('coupon-status-filter').value = '';
            loadCoupons();
        }

        function displayCoupons(coupons) {
            const tbody = document.getElementById('coupons-tbody');
            tbody.innerHTML = '';

            if (coupons.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">æš‚æ— ä¼˜æƒ åˆ¸æ•°æ®</td></tr>';
                return;
            }

            coupons.forEach(coupon => {
                const row = document.createElement('tr');
                const status = getCouponStatus(coupon);
                const typeText = getCouponTypeText(coupon.type);
                
                row.innerHTML = `
                    <td>${coupon.name}</td>
                    <td>${coupon.code}</td>
                    <td>${typeText}</td>
                    <td>${formatCouponValue(coupon.type, coupon.value)}</td>
                    <td>${coupon.minAmount > 0 ? 'æ»¡Â¥' + coupon.minAmount : 'æ— é™åˆ¶'}</td>
                    <td>${formatDate(coupon.startDate)} - ${formatDate(coupon.endDate)}</td>
                    <td>${coupon.usedQuantity}/${coupon.totalQuantity}</td>
                    <td><span class="status ${status.class}">${status.text}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="editCoupon('${coupon._id}')">ç¼–è¾‘</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCoupon('${coupon._id}')">åˆ é™¤</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function getCouponStatus(coupon) {
            const now = new Date();
            const startDate = new Date(coupon.startDate);
            const endDate = new Date(coupon.endDate);
            
            if (now < startDate) {
                return { class: 'pending', text: 'æœªå¼€å§‹' };
            } else if (now > endDate) {
                return { class: 'expired', text: 'å·²è¿‡æœŸ' };
            } else {
                return { class: 'active', text: 'è¿›è¡Œä¸­' };
            }
        }

        function getCouponTypeText(type) {
            const typeMap = {
                'amount': 'æ»¡å‡',
                'discount': 'æŠ˜æ‰£',
                'shipping': 'åŒ…é‚®'
            };
            return typeMap[type] || type;
        }

        function formatCouponValue(type, value) {
            if (type === 'discount') {
                return value + '%';
            } else if (type === 'amount') {
                return 'Â¥' + value;
                } else {
                return 'å…è´¹';
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN');
        }

        async function editCoupon(couponId) {
            try {
                // è·å–ä¼˜æƒ åˆ¸è¯¦æƒ…
                const response = await fetch(`http://localhost:5001/api/coupons/${couponId}`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        const coupon = data.data;
                        
                        // å¡«å……ç¼–è¾‘è¡¨å•
                        document.getElementById('coupon-name').value = coupon.name;
                        document.getElementById('coupon-type').value = coupon.type;
                        document.getElementById('coupon-value').value = coupon.value;
                        document.getElementById('coupon-min-amount').value = coupon.minAmount;
                        document.getElementById('coupon-start-date').value = new Date(coupon.startDate).toISOString().slice(0, 16);
                        document.getElementById('coupon-end-date').value = new Date(coupon.endDate).toISOString().slice(0, 16);
                        document.getElementById('coupon-total-quantity').value = coupon.totalQuantity;
                        document.getElementById('coupon-stackable').checked = coupon.stackable;
                        document.getElementById('coupon-description').value = coupon.description || '';
                        
                        // æ˜¾ç¤ºç¼–è¾‘è¡¨å•
                        document.getElementById('create-coupon-modal').style.display = 'block';
                        document.getElementById('create-coupon-modal').querySelector('h3').textContent = 'ç¼–è¾‘ä¼˜æƒ åˆ¸';
                        
                        // è®¾ç½®ç¼–è¾‘æ¨¡å¼
                        const form = document.getElementById('create-coupon-form');
                        form.setAttribute('data-edit-mode', 'true');
                        form.setAttribute('data-coupon-id', couponId);
                    } else {
                        alert('è·å–ä¼˜æƒ åˆ¸è¯¦æƒ…å¤±è´¥: ' + data.message);
                    }
                } else {
                    alert('è·å–ä¼˜æƒ åˆ¸è¯¦æƒ…å¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            } catch (error) {
                console.error('è·å–ä¼˜æƒ åˆ¸è¯¦æƒ…å¤±è´¥:', error);
                alert('è·å–ä¼˜æƒ åˆ¸è¯¦æƒ…å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        function deleteCoupon(couponId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä¼˜æƒ åˆ¸å—ï¼Ÿ')) {
                alert('åˆ é™¤ä¼˜æƒ åˆ¸åŠŸèƒ½å¾…å®ç°: ' + couponId);
            }
        }

        function showCreateCouponForm() {
            document.getElementById('create-coupon-modal').style.display = 'block';
        }

        function closeCreateCouponForm() {
            document.getElementById('create-coupon-modal').style.display = 'none';
            document.getElementById('create-coupon-form').reset();
            // é‡ç½®ç¼–è¾‘æ¨¡å¼
            const form = document.getElementById('create-coupon-form');
            form.removeAttribute('data-edit-mode');
            form.removeAttribute('data-coupon-id');
            // é‡ç½®æ ‡é¢˜
            document.getElementById('create-coupon-modal').querySelector('h3').textContent = 'åˆ›å»ºä¼˜æƒ åˆ¸';
        }

        async function exportCouponReport(format) {
            try {
                const response = await fetch('http://localhost:5001/api/coupons', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.data) {
                        const filename = `ä¼˜æƒ åˆ¸æŠ¥å‘Š_${new Date().toISOString().slice(0, 10)}.${format}`;
                        if (format === 'csv') {
                            exportToCSV(data.data, filename);
                        } else {
                            exportToExcel(data.data, filename);
                        }
                    } else {
                        alert('è·å–ä¼˜æƒ åˆ¸æ•°æ®å¤±è´¥');
                    }
                } else {
                    alert('è·å–ä¼˜æƒ åˆ¸æ•°æ®å¤±è´¥');
                }
            } catch (error) {
                console.error('å¯¼å‡ºä¼˜æƒ åˆ¸æŠ¥å‘Šå¤±è´¥:', error);
                alert('å¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        // ä¼˜æƒ åˆ¸è¡¨å•æäº¤å¤„ç†
        document.getElementById('create-coupon-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const couponData = {
                name: formData.get('name'),
                type: formData.get('type'),
                value: parseFloat(formData.get('value')),
                minAmount: parseFloat(formData.get('minAmount')),
                startDate: formData.get('startDate'),
                endDate: formData.get('endDate'),
                totalQuantity: parseInt(formData.get('totalQuantity')),
                stackable: formData.get('stackable') === 'on',
                description: formData.get('description')
            };
            
            try {
                const isEditMode = this.getAttribute('data-edit-mode') === 'true';
                const couponId = this.getAttribute('data-coupon-id');
                
                const url = isEditMode ? `http://localhost:5001/api/coupons/${couponId}` : 'http://localhost:5001/api/coupons';
                const method = isEditMode ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify(couponData)
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    alert(isEditMode ? 'ä¼˜æƒ åˆ¸æ›´æ–°æˆåŠŸï¼' : 'ä¼˜æƒ åˆ¸åˆ›å»ºæˆåŠŸï¼');
                    closeCreateCouponForm();
                    loadCoupons();
                } else {
                    alert((isEditMode ? 'æ›´æ–°å¤±è´¥' : 'åˆ›å»ºå¤±è´¥') + 'ï¼Œè¯·é‡è¯•');
                }
            } catch (error) {
                console.error('æ“ä½œå¤±è´¥:', error);
                alert('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        });

        // ç®¡ç†å‘˜é€€å‡ºç™»å½•
        function logoutAdmin() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç®¡ç†åå°å—ï¼Ÿ')) {
                localStorage.removeItem('token');
                localStorage.removeItem('loginType');
                window.location.href = 'personal-center.html';
            }
        }
    </script>
</body>
</html>